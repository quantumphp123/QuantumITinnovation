var quform=function(e,r,i,a){"use strict";var o,s=e.core,n=s.cache,t=!1,g=[],m=1,f=0,c=!0;return r((o={init:function(){n.get("#qfb_migrate_forms").change(function(){n.get("#qfb_migrate_forms_custom").closest(s.settingWrap)["specific"==n.get("#qfb_migrate_forms").val()?"qfbSlideShow":"qfbSlideHide"]()}),r.fn.select2&&n.get("#qfb_migrate_forms_custom").select2({theme:"qfb",language:{noResults:function(){return a.noResultsFound}}}),n.get("#qfb-migrate-start").click(o.startMigration),n.get("#qfb-migrate-stop").click(function(){c=!1,n.get("#qfb-migrate-stop-text").text(i.stopping)}),n.get("#qfb-migrate-close").click(function(){n.get("#qfb-migrate-progress").hide(),n.get("body").css("overflow",""),n.get("#qfb-migrate-progress-bar-inner").width(0),n.get("#qfb-migrate-current-task").attr("class","qfb-message-box qfb-message-box-info"),n.get("#qfb-migrate-current-task-text").text(i.processing),n.get("#qfb-migrate-close").hide(),n.get("#qfb-migrate-stop-text").text(i.stopMigration),n.get("#qfb-migrate-progress").find(".qfb-submission-error").remove(),n.get("#qfb-migrate-errors").empty()}),n.get("#qfb-import-form-button").click(o["import"])},startMigration:function(){var e;n.get(".qfb-tools-migrate").find(".qfb-validation-error").remove(),"specific"!=n.get("#qfb_migrate_forms").val()||(e=n.get("#qfb_migrate_forms_custom").val(),r.isArray(e)&&e.length)?(n.get("#qfb-migrate-progress").show(),n.get("body").css("overflow","hidden"),n.get("#qfb-migrate-progress-bar-inner").width(0),n.get("#qfb-migrate-current-task-text").text(i.processing),"specific"==n.get("#qfb_migrate_forms").val()?(e=r.map(e,function(e){return parseInt(e,10)}),o.migrateForms(e)):r.ajax({type:"POST",url:a.ajaxUrl,data:{action:"quform_migrate_get_all_form_ids"},dataType:"json"}).done(function(e){"success"==(e=s.sanitiseResponse(e)).type&&r.isArray(e.formIds)&&e.formIds.length?o.migrateForms(e.formIds):o.migrationFailed(e.message)}).fail(function(){o.migrationFailed(a.ajaxError)}),(n.get("#qfb_migrate_license").is(":checked")||n.get("#qfb_migrate_recaptcha_keys").is(":checked"))&&r.ajax({type:"POST",url:a.ajaxUrl,data:{action:"quform_migrate_settings",_ajax_nonce:i.migrateSettingsNonce,migrate_license_key:n.get("#qfb_migrate_license").is(":checked")?"1":"0",migrate_recaptcha_keys:n.get("#qfb_migrate_recaptcha_keys").is(":checked")?"1":"0"},dataType:"json"}).done(function(e){"error"==(e=s.sanitiseResponse(e)).type&&s.addValidationError(n.get("#qfb-migrate-errors"),i.errorMigratingKeys.replace("%s",e.message))}).fail(function(){s.addValidationError(n.get("#qfb-migrate-errors"),i.errorMigratingKeys.replace("%s",a.ajaxError))})):s.addValidationError(n.get("#qfb_migrate_forms_custom").closest(s.settingInputWrap),a.thisFieldIsRequired)},migrateForms:function(e){f=(g=e).length,m=1,c=!0,n.get("#qfb-migrate-stop").css("display","inline-block"),o.migrateForm(g.shift())},migrateForm:function(t){r.ajax({type:"POST",url:a.ajaxUrl,data:{action:"quform_migrate_form",_ajax_nonce:i.migrateNonce,form_id:t,migrate_entries:n.get("#qfb_migrate_entries").is(":checked")?"1":"0"},dataType:"json"}).done(function(e){o.updateStatus(t,s.sanitiseResponse(e))}).fail(function(){o.updateStatus(t,{type:"error",message:a.ajaxError})})},updateStatus:function(e,t){var r=Math.round(m/f*100);n.get("#qfb-migrate-progress-bar-inner").width(r+"%"),m++,"error"==t.type&&s.addValidationError(n.get("#qfb-migrate-errors"),i.errorMigratingForm.replace("%d",e).replace("%s",t.message)),g.length&&c?o.migrateForm(g.shift()):o.migrationCompleted()},migrationCompleted:function(){n.get("#qfb-migrate-stop").hide(),n.get("#qfb-migrate-close").css("display","inline-block"),c?(n.get("#qfb-migrate-current-task").attr("class","qfb-message-box qfb-message-box-success"),n.get("#qfb-migrate-current-task-text").text(i.migrationCompleted)):n.get("#qfb-migrate-current-task-text").text(i.migrationStopped)},migrationFailed:function(e){n.get("#qfb-migrate-stop").hide(),n.get("#qfb-migrate-close").css("display","inline-block"),s.addSubmissionError(n.get("#qfb-migrate-progress-inner"),i.errorStartingMigration.replace("%s",e)),n.get("#qfb-migrate-current-task").attr("class","qfb-message-box qfb-message-box-error"),n.get("#qfb-migrate-current-task-text").text(i.migrationError)},validate:function(){if(n.get(".qfb-tools-migrate").find(".qfb-validation-error").remove(),""===n.get("#qfb-import-form-data").val()){var e=n.get("#qfb-import-form-data").closest(s.settingWrap);return s.addValidationError(e,a.thisFieldIsRequired),s.scrollTo(e),!1}return!0},"import":function(){if(!t){if(!o.validate())return!1;t=!0,r.ajax({type:"POST",url:a.ajaxUrl,data:{action:"quform_migrate_import_form",_ajax_nonce:i.migrateImportFormNonce,config:n.get("#qfb-import-form-data").val()},dataType:"json"}).done(function(e){e=s.sanitiseResponse(e),n.get(".qfb-tools-migrate").find(".qfb-validation-error").remove(),t=!1,"success"==e.type?o.onImportSuccess(e.message):"error"!=e.type&&"invalid"!=e.type||o.onImportFail(e)}).fail(function(){n.get(".qfb-tools-migrate").find(".qfb-validation-error").remove(),t=!1,o.onImportFail({message:a.ajaxError})})}},onImportSuccess:function(e){s.showFixedMessage(e,"success",0)},onImportFail:function(e){var a;s.isNonEmptyString(e.message)&&s.showFixedMessage(i.errorImportingForm+"<br>"+e.message,"error"),e.errors&&r.each(e.errors,function(e,t){var r=n.get("#"+e).closest(s.settingWrap);a||(a=r),s.addValidationError(r,t)}),a&&s.scrollTo(a)}}).init),e.tools=e.tools||{},e.tools.migrate=o,e}(quform,jQuery,quformToolsMigrateL10n,quformCoreL10n);